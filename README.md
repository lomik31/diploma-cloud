# Дипломная работа по проектированию и созданию облачного хранилища

# Используемые инструменты
Ниже перечислены инструменты, которые были использованы в проекте (не включая рекомендуемые по заданию).
- Docker, Docker compose — контейнеризация приложений и автоматизация развертывания.
  Документация: https://docs.docker.com/
- Nginx — веб сервер, маршрутизирует запросы до backend, отдает статику frontend.
  Документация: https://nginx.org/en/docs/index.html
- Bash-скрипты. Используются как ентрипоинты docker и в установщике.
#### Frontend
- Typescript — frontend полностью написан на языке typescript.
  Документация: https://www.typescriptlang.org/docs/
- Vite — dev сервер, удобный билдер.
  Документация: https://vite.dev/guide/
- Lucide — библиотека иконок. Использовалась как npm библиотека `lucide-react`.
  Сайт: https://lucide.dev/
- Axios — библиотека npm для отправки запросов, HTTP-клиент. Предоставляет удобный интерфейс. Позволяет единоразово настроить конфигурацию и в дальнейшем использовать для всех запросов.
  Документация: https://axios-http.com/docs/
- `react-query` — библиотека npm для управления запросами. Позволяет упорядочить запросы (предотвращает гонку данных), кешировать данные, интеграция с React позволяет после изменения данных обновлять состояния на странице (мутации).
  Документация: https://tanstack.com/query/v5/docs/framework/react/overview
- Eslint — линтер кода js, ts
  Документация: https://eslint.org/docs/latest/
#### Backend
- uv — менеджер проектов и пакетов. Позволяет удобно в одну команду создавать проект (со всеми pyproject, venv и git), устанавливать пакеты с высокой скоростью и много чего ещё.
  Документация: https://docs.astral.sh/uv/
- Ruff — линтер и форматтер python-кода.
  Документация: https://docs.astral.sh/ruff/
- `django-environ` — python-пакет, позволяет django читать переменные окружения, а так же считывать значения из .env файлов.
  Документация: https://django-environ.readthedocs.io/en/latest/
- `djangorestframework-simplejwt` — интеграция для Djnago Rest Framework, позволяющая выпускать последнему токеты авторизации в формате JWT. Python-пакет.
  Документация: https://django-rest-framework-simplejwt.readthedocs.io/en/latest/
- Uvicorn — asgi для Django и других веб-приложений. Python-пакет.
  Документация: https://www.uvicorn.org/


# Структура проекта
Проект делится на 3 части. Frontend, backend и nginx, хранящиеся в одноименных директориях в корне проекта. Внутри находятся конфигурационные файлы и исходный код (применимо только к backend и frontend) в директориях src.
## Структура backend:
Имеется два приложения — `storage` и `users`. Первый отвечает за все действия с файлами: получение списка, загрузка, скачивание, переименование, удаление и т.д. Второй — за действия с пользователями. Регистрация, авторизация, список пользователей, их редактирование и удаление (для админов), работа с токенами (получение нового (в обмен на логин и пароль), обновление access-токена, деактивация refresh-токена (логаут)).
В директории `utils` находятся настройки проекта и базовые пути.
## Структура frontend:
В файле `App.tsx` прописаны все роуты приложения.
В директории `pages` находятся сами страницы, которые включают в себя компоненты из директории `components`.
В директории `api` находятся все функции для работы с api. Они могут вызываться в любых местах приложения.
В директории `context` находятся контексты для работы некоторых компонентов. Например, всплывающие подсказки и авторизация.

# Установка

## Требования
- `linux`
- `bash`
- `git`
- `openssl`

## Настройки проекта
Перед запуском установщика вы моежете настроить дополнительные параметры. Для этого вы можете открыть файл `.env` в корне проекта любым текстовым редактором и отредактировать/добавить настройки.

### Доступные параметры:
- `STORAGE_LOCATION` — путь к директории, где будут храниться пользовательские файлы (желательно указывать абсолютный путь).
  Пример: `STORAGE_LOCATION=/home/user/cloud_storage`
- `DATABASE_USER` — пользователь базы данных, под которым будет работать процесс
- `DATABASE_PASSWORD` — пароль пользователя `DATABASE_USER`. !!Рекомендуется изменить!!
- `DATABASE_NAME` — имя базы данных, используемой в проекте.

## Учетная запись администратора файлового хранилища
Учетная запись администратора будет создана автоматически при первом запуске контейнера django. Имя пользователя: `admin`. Пароль будет сгенерирован автоматически и отображен в логах контейнера при первом запуске.

## Автоматическая установка:

```bash
git clone https://github.com/lomik31/diploma-cloud.git
cd diploma-cloud
# На этом шаге вы можете изменить параметры, описанные выше по своему желанию
bash installer.sh
```

После запуска установщика, будет установлен `docker` и `docker compose` (если отсутствует), сгенерирован django secret key, в интерактивном режиме будет заданы вопросы по поводу используемых доменов и tls-сертификатов. Если домен указан не будет, в качестве домена внешний возьмется ip-адрес машины.

## Ручная установка:
### Дополнительные требования:
- docker
- docker compose
### Установка
1. Сгенерируйте django secret key и положите его по пути `./backend/.env` в формате:
  ```env
  DJANGO_SECRET_KEY="ВАШ DJANGO SECRET KEY"
  ```
2. Укажите домен, на котором будет работать приложение. В качестве домена можно указать ip-адрес.
  Откройте текстовым редактором файл `./.env` и добавьте в конец ваши домены в формате
  ```env
  DOMAINS=localhost,127.0.0.1,...
  ```
3. Положите в директорию `./certs/` (`./nginx/certs/`) ваш сертификат и ключ, соответствующий вашим доменам. Сертификат должен быть в формате `.crt`, ключ в формате `.key`. Файлы должны называться `fullchain.crt` и `private.key` соответственно. Если сертификатов нет, они будут сгенерированы автоматически и появятся в директории `./certs/`.

4. Создайте docker-тома `prod_postgres_data` (том базы данных) и `userfiles` (том файлов пользователей). Том `userfiles` обязателен для создания даже если вы указали `STORAGE_LOCATION` в `.env` файле. Он необходим только для запуска docker, фактически использоваться не будет и файлы будут лежать в указанной директории.
  Сделать это можно командой
  ```bash
  docker volume create prod_postgres_data && docker volume create userfiles
  ```
5. Запустите проект
  ```bash
  docker compose up -d
  ```
